<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Novella App - Main</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preload" href="/fonts/Uni Sans.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="/fonts/MaiandraGD.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="/fonts/Unispace.ttf" as="font" type="font/ttf" crossorigin="anonymous">
</head>
<body>
    <div class="main-page">
        <header>
            <button class="freedurov-button" id="freedurov-button" onclick="window.open('https://www.change.org/p/free-pavel-durov-freedurov?source_location=tag_')">
                #FREEDUROV
            </button>
        </header>
        <div class="token-section">
            <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1725622251/Novellacoin.png" alt="Token Icon" class="token-icon" id="token-icon">
            <p id="token-balance" class="token-balance">0</p>
        </div>

        <!-- Daily Reward - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥ –∏ –±–æ–Ω—É—Å—ã -->
        <div class="daily-reward-container">
            <p class="daily-reward-title" id="daily-reward-title">üéÅ DAILY REWARDS</p>
            <div class="daily-reward-wrapper">
                <button id="claim-reward-button" class="daily-reward-button" onclick="claimReward()">Daily Check in +100 $Novella</button>
                <button id="premium-reward-button" class="premium-reward-button" onclick="claimPremiumReward()">Premium Check in +1000 $Novella</button>
                <div class="timer-container">
                    <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1726574752/Element/Timer.png" alt="Timer" class="timer-icon">
                    <span id="timer" class="timer">24:00:00</span>
                </div>
            </div>
        </div>

        <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - Personal Settings -->
        <div class="personal-settings-container">
            <p class="personal-settings-title" id="personal-settings-title">‚öôÔ∏è PERSONAL SETTINGS</p>
            <div class="personal-settings-wrapper">
            <button class="personal-language-button" id="languagebutton" title="Lanauge">üëÖ</button> <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
            </div>
        </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="LanguageModalPanel" class="modal">
        <div class="modal-content">
            <h2>¬∑ Select Language ¬∑</h2>
            <select id="country-select">
                <option value="en-US">English üá∫üá∏</option>
                <option value="ru-RU">Russian üá∑üá∫</option>
                <option value="uk-UA">Ukrainian üá∫üá¶</option>
            </select>
            <button class="save-button" id="save-language-btn">Save</button> <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å -->
            <button class="close-button" id="close-language-btn">Close</button> <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å -->
        </div>
    </div>  

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
    <script>
        const settingsButton = document.getElementById('languagebutton');
        const modal = document.getElementById('LanguageModalPanel');
        const closeButton = document.getElementById('close-language-btn'); // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π id

        settingsButton.addEventListener('click', () => {
            modal.style.display = 'flex'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        });

        closeButton.addEventListener('click', () => {
            modal.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        });

        window.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = 'none'; // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –Ω–µ–≥–æ
            }
        }
    </script>

        <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
        <nav class="bottom-menu">
            <a href="index.html" class="menu-item active">
                <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1726420961/Menu/Button%20version%202/Main_iconmenu.png" alt="Main">
                <span id="menu-main">Main</span>
            </a>
            <a href="task.html" class="menu-item">
                <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1726420961/Menu/Button%20version%202/Task_iconmenu.png" alt="Task">
                <span id="menu-task">Task</span>
            </a>
            <a href="friends.html" class="menu-item">
                <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1726937838/Menu/Button%20version%202/Friends.png" alt="Friends">
                <span id="menu-friends">Friends</span>
            </a>
            <a href="airdrop.html" class="menu-item">
                <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1726420961/Menu/Button%20version%202/Airdrop_iconmenu.png" alt="Airdrop">
                <span id="menu-airdrop">Airdrop</span>
            </a>
            <a href="leaders.html" class="menu-item">
                <img src="https://res.cloudinary.com/dvjohgg6j/image/upload/v1726420961/Menu/Button%20version%202/Leaders_iconmenu.png" alt="Leaders">
                <span id="menu-leaders">Leaders</span>
            </a>
        </nav>
    </div>
    
    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ç–æ–∫–µ–Ω–∞ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tokenIcon = document.getElementById('token-icon');

            if (tokenIcon) {
                tokenIcon.addEventListener('click', () => {
                    const audio = new Audio('/sound/nose-sound.mp3');
                    audio.play();
                });
            }
        });
    </script>

    <script>
        const countrySelect = document.getElementById('country-select');

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∫–ª–∏–∫ –ø–æ –≤—ã–ø–∞–¥–∞—é—â–µ–º—É —Å–ø–∏—Å–∫—É
        countrySelect.addEventListener('click', () => {
            if (countrySelect.classList.contains('open')) {
                countrySelect.classList.remove('open'); // –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–ø–∏—Å–∫–∞, —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å open
            } else {
                countrySelect.classList.add('open'); // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–ø–∏—Å–∫–∞, –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å open
            }
        });

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–∏
        countrySelect.addEventListener('change', () => {
            countrySelect.classList.remove('open'); // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å open –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–∏
        });

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º blur –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞, –∫–æ–≥–¥–∞ —ç–ª–µ–º–µ–Ω—Ç —Ç–µ—Ä—è–µ—Ç —Ñ–æ–∫—É—Å
        countrySelect.addEventListener('blur', () => {
            countrySelect.classList.remove('open'); // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å open –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        });
    </script>

    <!-- –°–∫—Ä–∏–ø—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è userid, telegramid –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞, —Ç–æ–∫–µ–Ω–æ–≤ -->
    <script>
        // –ü–æ–ª—É—á–∞–µ–º telegramId –∏–∑ URL –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        const urlParams = new URLSearchParams(window.location.search);
        const telegramId = urlParams.get('userId');
    
        // –°–∫—Ä–∏–ø—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è userid, telegramid –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞, —Ç–æ–∫–µ–Ω–æ–≤
        document.addEventListener('DOMContentLoaded', async function() {
            const tokenBalanceElement = document.getElementById('token-balance');
    
            if (telegramId) {
                try {
                    const response = await fetch(`/check-user/${telegramId}`);
                    const data = await response.json();
    
                    if (response.ok) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                        tokenBalanceElement.textContent = data.tokens;
                    } else {
                        console.error('–û—à–∏–±–∫–∞:', data.error);
                        // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç
                        if (data.redirect) {
                            window.location.href = data.redirect;
                        }
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                }
            } else {
                console.error('telegramId –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ URL.');
            }
        });
    
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫–∏ –≤ –Ω–∏–∂–Ω–µ–º –º–µ–Ω—é, –µ—Å–ª–∏ telegramId —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (telegramId) {
            const menuItems = document.querySelectorAll('.bottom-menu a');
            menuItems.forEach(item => {
                const originalHref = item.getAttribute('href');
                item.setAttribute('href', `${originalHref}?userId=${telegramId}`);
            });
    
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º telegramId –≤ –∏—Å—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –æ–Ω–æ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–æ—Å—å
            history.replaceState(null, '', `${window.location.pathname}?userId=${telegramId}`);
        }
    </script>    

    <!-- –°–∫—Ä–∏–ø—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã -->
    <script src="/dailyreward.js"></script>

    <!-- –°–∫—Ä–∏–ø—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ -->    
    <script src="/localization.js"></script>
</body>
</html>